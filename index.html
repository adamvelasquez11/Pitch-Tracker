<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PitchGuard • Youth Arm Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Space+Grotesk:wght@500;600;700&display=swap');
        
        body { font-family: 'Inter', system-ui, sans-serif; }
        .title-font { font-family: 'Space Grotesk', sans-serif; }
        .neon-glow { text-shadow: 0 0 20px #00ff99; }
        .card { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .card:hover { transform: translateY(-8px) scale(1.02); }
        .stress-bar { transition: width 0.9s cubic-bezier(0.34, 1.56, 0.64, 1); }
    </style>
</head>
<body class="bg-zinc-950 text-white min-h-screen pb-12">

    <div class="max-w-2xl mx-auto px-4 pt-8">
        <div class="flex items-center justify-between mb-6">
            <div>
                <h1 class="title-font text-5xl font-bold tracking-tighter neon-glow text-emerald-400">PITCHGUARD</h1>
                <p class="text-zinc-400 text-sm tracking-[3px]">YOUTH ARM PROTECTION MONITOR</p>
            </div>
        </div>

        <!-- Pitcher Profile -->
        <div class="card bg-zinc-900/70 border border-zinc-800 rounded-3xl p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4 text-emerald-400">Pitcher Profile</h2>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm text-zinc-400 mb-1">Age (years)</label>
                    <input type="number" id="age" value="15" min="8" max="30" class="w-full bg-zinc-800 border border-zinc-700 rounded-lg px-3 py-2 text-white">
                </div>
                <div>
                    <label class="block text-sm text-zinc-400 mb-1">Sex</label>
                    <select id="sex" class="w-full bg-zinc-800 border border-zinc-700 rounded-lg px-3 py-2 text-white">
                        <option value="boy">Boy</option>
                        <option value="girl">Girl</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm text-zinc-400 mb-1">Height (inches)</label>
                    <input type="number" id="height" value="72" min="40" max="80" class="w-full bg-zinc-800 border border-zinc-700 rounded-lg px-3 py-2 text-white">
                </div>
                <div>
                    <label class="block text-sm text-zinc-400 mb-1">Weight (lbs)</label>
                    <input type="number" id="weight" value="200" min="50" max="300" class="w-full bg-zinc-800 border border-zinc-700 rounded-lg px-3 py-2 text-white">
                </div>
            </div>
            <button onclick="updateProfile()" class="mt-4 bg-emerald-600 hover:bg-emerald-500 text-black font-semibold py-2 px-6 rounded-xl">
                Apply Profile
            </button>
            <div id="profileMessage" class="mt-3 text-sm text-emerald-400 font-medium"></div>
        </div>

        <!-- Buttons -->
        <div class="flex gap-3 mb-8 justify-center">
            <button onclick="simulatePitch()" class="flex-1 bg-white hover:bg-zinc-100 text-zinc-900 font-semibold py-4 rounded-2xl text-lg transition-all active:scale-95">
                SIMULATE PITCH
            </button>
            <button onclick="resetSession()" class="flex-1 bg-zinc-800 hover:bg-zinc-700 font-semibold py-4 rounded-2xl text-lg transition-all active:scale-95">
                RESET
            </button>
        </div>

        <!-- Metrics -->
        <div class="grid grid-cols-2 gap-4 mb-8">
            <div class="card bg-zinc-900/70 border border-zinc-800 rounded-3xl p-6">
                <p class="text-zinc-400 text-sm">TOTAL PITCHES</p>
                <p id="pitchCount" class="text-6xl font-bold title-font tracking-tighter text-white">0</p>
            </div>
            <div class="card bg-zinc-900/70 border border-zinc-800 rounded-3xl p-6">
                <p class="text-zinc-400 text-sm">LAST VELO</p>
                <p id="lastVelo" class="text-6xl font-bold title-font tracking-tighter text-emerald-400">--</p>
                <p class="text-xs text-zinc-500">mph</p>
            </div>
            <div class="card bg-zinc-900/70 border border-zinc-800 rounded-3xl p-6">
                <p class="text-zinc-400 text-sm">AVG VELO</p>
                <p id="avgVelo" class="text-6xl font-bold title-font tracking-tighter text-emerald-400">--</p>
                <p class="text-xs text-zinc-500">mph</p>
            </div>
            <div class="card bg-zinc-900/70 border border-zinc-800 rounded-3xl p-6">
                <p class="text-zinc-400 text-sm">PEAK VELO</p>
                <p id="peakVelo" class="text-6xl font-bold title-font tracking-tighter text-emerald-400">--</p>
                <p class="text-xs text-zinc-500">mph</p>
            </div>
        </div>

        <div class="card bg-zinc-900/70 border border-zinc-800 rounded-3xl p-6 mb-8">
            <div class="flex justify-between items-baseline">
                <p class="text-zinc-400 text-sm">SPIN RATE</p>
                <p id="lastSpin" class="text-5xl font-bold title-font tracking-tighter text-rose-400">--</p>
            </div>
            <p class="text-xs text-zinc-500">rpm</p>
        </div>

        <div class="card bg-zinc-900/70 border border-zinc-800 rounded-3xl p-8 mb-8">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <p class="text-rose-400 font-medium">ARM STRESS INDEX</p>
                    <p id="stressLevel" class="text-3xl font-semibold text-white">LOW</p>
                </div>
                <div class="text-right">
                    <p id="stressPercent" class="text-6xl font-bold title-font tracking-tighter text-white">0</p>
                    <p class="text-sm text-zinc-500 -mt-2">%</p>
                </div>
            </div>
            <div class="h-5 bg-zinc-800 rounded-2xl overflow-hidden">
                <div id="stressBar" class="h-full bg-gradient-to-r from-emerald-400 via-yellow-400 to-rose-500 stress-bar" style="width: 0%"></div>
            </div>
            <p id="stressMessage" class="text-center text-sm mt-3 text-emerald-400 font-medium">
                Safe — keep throwing!
            </p>
        </div>

        <div class="bg-zinc-900/70 border border-zinc-800 rounded-3xl p-6">
            <canvas id="pitchChart" height="240"></canvas>
        </div>
    </div>

<script>
let pitchCount = 0;
let velocities = [];
let spins = [];
let armStress = 0;
let recentSpeeds = [];

let profile = { age: 15, sex: 'boy', height: 72, weight: 200 };

let chart;
let chartData = {
    labels: [],
    datasets: [
        { label: 'Velocity (mph)', borderColor: '#00ff99', borderWidth: 4, tension: 0.3, yAxisID: 'y', data: [] },
        { label: 'Spin Rate (rpm)', borderColor: '#ff3366', borderWidth: 3, tension: 0.3, yAxisID: 'y1', data: [] }
    ]
};

function initChart() {
    chart = new Chart(document.getElementById('pitchChart'), {
        type: 'line',
        data: chartData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { labels: { color: '#ddd' } } },
            scales: {
                x: { grid: { color: '#333' }, ticks: { color: '#666' } },
                y:  { position: 'left', grid: { color: '#333' }, ticks: { color: '#00ff99' } },
                y1: { position: 'right', grid: { drawOnChartArea: false }, ticks: { color: '#ff3366' } }
            }
        }
    });
}

function getDailyPitchLimit() {
    let age = profile.age;
    let baseLimit;

    if (profile.sex === 'boy') {
        if (age <= 9) baseLimit = 32;
        else if (age <= 10) baseLimit = 35;
        else if (age <= 12) baseLimit = 48;
        else if (age <= 14) baseLimit = 65;
        else if (age <= 15) baseLimit = 75;
        else if (age <= 16) baseLimit = 85;
        else if (age <= 17) baseLimit = 95;
        else if (age <= 18) baseLimit = 95;
        else if (age <= 20) baseLimit = 105;
        else if (age <= 24) baseLimit = 115;
        else baseLimit = 130;
    } else {
        if (age <= 11) baseLimit = 28;
        else if (age <= 12) baseLimit = 35;
        else if (age <= 15) baseLimit = 50;
        else if (age <= 17) baseLimit = 68;
        else if (age <= 20) baseLimit = 92;
        else baseLimit = 105;
    }

    // Body-size adjustment (heavier/taller get a realistic boost)
    let bodyBonus = 1 + (profile.weight - 125) * 0.00145 + (profile.height - 62) * 0.0035;
    bodyBonus = Math.max(0.92, Math.min(1.32, bodyBonus));
    let adjusted = Math.round(baseLimit * bodyBonus);

    // Introduce randomization around the adjusted limit (range roughly ±12–15%)
    // This creates natural variation so not everyone hits exactly the same number
    let variation = Math.floor(Math.random() * 19) - 9;  // -9 to +9
    let randomizedLimit = adjusted + variation;

    // Hard cap: no profile should exceed ~100–105 effective limit
    randomizedLimit = Math.min(105, Math.max(25, randomizedLimit));

    return randomizedLimit;
}

function updateProfile() {
    profile.age = parseInt(document.getElementById('age').value) || 15;
    profile.sex = document.getElementById('sex').value;
    profile.height = parseInt(document.getElementById('height').value) || 72;
    profile.weight = parseInt(document.getElementById('weight').value) || 200;

    const msg = document.getElementById('profileMessage');
    msg.textContent = `Profile updated — ${profile.age}yo ${profile.sex} (${profile.height}" ${profile.weight} lbs)`;
    setTimeout(() => msg.textContent = '', 4500);
}

function simulatePitch() {
    const isFastball = Math.random() < 0.70;

    let baseVelo = 38 + (profile.age - 8) * 2.15 + (profile.height - 55) * 0.32 + (profile.weight - 80) * 0.085;
    if (profile.sex === 'girl') baseVelo *= 0.9;

    let speed, spin;
    if (isFastball) {
        speed = (Math.random() * 6 + baseVelo).toFixed(1);
        spin  = Math.floor(Math.random() * 420 + 1380);
    } else {
        speed = (Math.random() * 7 + baseVelo * 0.82).toFixed(1);
        spin  = Math.floor(Math.random() * 480 + 1980);
    }

    speed = Math.max(38, Math.min(74, parseFloat(speed)));
    spin  = Math.max(1250, Math.min(2650, spin));

    pitchCount++;
    velocities.push(speed);
    spins.push(spin);
    recentSpeeds.push(speed);
    if (recentSpeeds.length > 8) recentSpeeds.shift();

    document.getElementById('pitchCount').textContent = pitchCount;
    document.getElementById('lastVelo').textContent = speed.toFixed(1);
    document.getElementById('lastSpin').textContent = spin;

    let avg = velocities.length ? (velocities.reduce((a,b)=>a+b,0) / velocities.length).toFixed(1) : '--';
    let peak = velocities.length ? Math.max(...velocities).toFixed(1) : '--';
    document.getElementById('avgVelo').textContent = avg;
    document.getElementById('peakVelo').textContent = peak;

    updateCumulativeStress(speed, spin, isFastball);

    const allVelo = chartData.datasets[0].data;
    const allSpin = chartData.datasets[1].data;
    if (allVelo.length > 0) {
        chart.options.scales.y.min = Math.max(35, Math.floor(Math.min(...allVelo)) - 8);
        chart.options.scales.y.max = Math.ceil(Math.max(...allVelo)) + 8;
    }
    if (allSpin.length > 0) {
        chart.options.scales.y1.min = Math.max(1100, Math.floor(Math.min(...allSpin)) - 150);
        chart.options.scales.y1.max = Math.ceil(Math.max(...allSpin)) + 150;
    }

    chartData.labels.push(pitchCount);
    chartData.datasets[0].data.push(speed);
    chartData.datasets[1].data.push(spin);
    chart.update();
}

function updateCumulativeStress(speed, spin, isFastball) {
    const dailyLimit = getDailyPitchLimit();
    
    let baseVelo = 38 + (profile.age - 8) * 2.15 + (profile.height - 55) * 0.32 + (profile.weight - 80) * 0.085;
    if (profile.sex === 'girl') baseVelo *= 0.9;
    let expectedVelo = isFastball ? baseVelo + 3 : baseVelo * 0.82 + 3.5;

    let factor = isFastball ? 1.00 : 1.28;
    factor += (speed - expectedVelo) * 0.012;
    factor += (spin - 1850) * 0.00019;

    factor = Math.max(0.82, Math.min(1.65, factor));

    let perPitch = (100 / dailyLimit) * factor;
    perPitch = Math.max(0.35, perPitch);

    armStress = Math.min(100, armStress + perPitch);

    let percent = Math.round(armStress);
    document.getElementById('stressPercent').textContent = percent;
    document.getElementById('stressBar').style.width = percent + '%';

    let level = 'LOW', message = 'Safe — keep throwing!', msgClass = 'text-emerald-400';

    if (percent >= 75) {
        level = 'CRITICAL';
        message = 'STOP PITCHING — High injury risk!';
        msgClass = 'text-rose-400 font-bold';
        document.getElementById('stressBar').style.background = 'linear-gradient(to right, #f43f5e, #e11d48)';
    } else if (percent >= 50) {
        level = 'CAUTION';
        message = 'Strong caution — rest soon';
        msgClass = 'text-yellow-400';
        document.getElementById('stressBar').style.background = 'linear-gradient(to right, #eab308, #f59e0b)';
    } else if (percent >= 25) {
        level = 'MODERATE';
        message = 'Moderate risk building';
        msgClass = 'text-amber-300';
        document.getElementById('stressBar').style.background = 'linear-gradient(to right, #fbbf24, #d97706)';
    } else {
        document.getElementById('stressBar').style.background = 'linear-gradient(to right, #10b981, #34d399)';
    }

    document.getElementById('stressLevel').textContent = level;
    document.getElementById('stressMessage').textContent = message;
    document.getElementById('stressMessage').className = `text-center text-sm mt-3 ${msgClass} font-medium`;
}

function resetSession() {
    pitchCount = 0;
    velocities = [];
    spins = [];
    recentSpeeds = [];
    armStress = 0;

    document.getElementById('pitchCount').textContent = '0';
    document.getElementById('lastVelo').textContent = '--';
    document.getElementById('avgVelo').textContent = '--';
    document.getElementById('peakVelo').textContent = '--';
    document.getElementById('lastSpin').textContent = '--';

    document.getElementById('stressPercent').textContent = '0';
    document.getElementById('stressBar').style.width = '0%';
    document.getElementById('stressLevel').textContent = 'LOW';
    document.getElementById('stressMessage').textContent = 'Safe — keep throwing!';
    document.getElementById('stressMessage').className = 'text-center text-sm mt-3 text-emerald-400 font-medium';

    chartData.labels = [];
    chartData.datasets[0].data = [];
    chartData.datasets[1].data = [];
    chart.update();
}

window.onload = () => {
    initChart();
    updateProfile();
};
</script>
</body>
</html>
